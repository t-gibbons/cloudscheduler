<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 8px;
        }
        th {
            text-align: right;
        }
    </style>
</head>

{% if err_message is not None %}
    <p style="color:red;">{{err_message}}</p>
{% endif %}
{% if message is not None %}
    <p style="color:green;">{{message}}</p>
{% endif %}

<table>
    <tr><th>Cloud name</th></tr>
    {% for cloud in cloud_list %}
        <tr>
            <td>{{cloud.cloud_name}}</td>
            <td><button type="button" class="btn btn-info" data-toggle="collapse" data-target="#{{cloud.cloud_name}}" style="margin-right: 5px"> Edit </button>
                <div class="collapse" id="{{cloud.cloud_name}}" style="width: 400px">
                    <form name="{{cloud.cloud_name}}" action="/update_cloud/" method="post">
                        {% csrf_token %}
                        <table>
                            <tr><td><label for="cloud_name">Cloud name</label></td>
                            <td><input type="text" name="cloud_name" id="" value="{{cloud.cloud_name}}" /></td></tr>
                            <tr><td><label for="authurl">URL</label></td>
                            <td><input type="text" name="authurl" id="" value="{{cloud.authurl}}" /></td></tr>
                            <tr><td><label for="username">Username</label></td>
                            <td><input type="text" name="username" id="" value="{{cloud.username}}" /></td></tr>
                            <tr><td><label for="password">Password</label></td>
                            <td><input type="password" name="password" id="" value="{{cloud.password}}" /></td></tr>
                            <input type="hidden" name="action" value="modify" />
                            <tr><td><input type="submit" value="Update Cloud" /></td>
                            <td><input type="button" onclick="confirmDelete('{{cloud.cloud_name}}')" value="Delete" style="background-color: red; color: black; float: right"/></td></tr>
                        </table>
                    </form>
                </div>
</td>
        </tr>
    {% endfor %}
</table>

<div style="padding-left: 25px; padding-top: 25px">
    <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#create_cloud" style="margin-right: 5px"> Add Cloud </button>
    <div class="collapse" id="create_cloud" style="width: 400px">
        <form name="create_cloud" action="/update_cloud/" method="post">
            {% csrf_token %}
            <table>
                <tr><td><label for="cloud_name">Cloud name</label></td>
                <td><input type="text" name="cloud_name" id="" value="" /></td></tr>
                <tr><td><label for="authurl">URL</label></td>
                <td><input type="text" name="authurl" id="" value="" /></td></tr>
                <tr><td><label for="username">Username</label></td>
                <td><input type="text" name="username" id="" value="" /></td></tr>
                <tr><td><label for="password">Password</label></td>
                <td><input type="password" name="password" id="" value="" /></td></tr>
                <input type="hidden" name="action" value="add" />
                <tr><td><input type="submit" value="Add Cloud" /></td></tr>
            </table>
        </form>
    </div>
</div>


<script>
    function confirmDelete(cloud) {
        if (confirm("Are you sure you want to delete '" + cloud + "'") == true) {;
            $.post("/update_cloud/", {cloud_name: cloud, csrfmiddlewaretoken: '{{csrf_token}}', authurl: "", username: "", password: "" , action: 'delete'}, function(result){
                if(result){
                    window.location.href = "/update_cloud/";
                }
                else{
                    //something happened with delete, maybe give an error msg?
                }
            })
        } 
    }
</script>